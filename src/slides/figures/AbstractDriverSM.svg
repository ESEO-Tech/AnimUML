<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="499px" preserveAspectRatio="none" style="width:1021px;height:499px;" version="1.1" viewBox="0 0 1021 499" width="1021px" zoomAndPan="magnify"><defs><filter height="300%" id="f6hx1o08ljaqj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><polygon fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" points="520.804,8,532.804,20,520.804,32,508.804,20,520.804,8" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" points="272.804,451,284.804,463,272.804,475,260.804,463,272.804,451" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="863.804" cy="20" fill="#000000" filter="url(#f6hx1o08ljaqj)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="734.804" y="139"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="734.804" x2="914.804" y1="165.2969" y2="165.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="24" x="812.804" y="156.9951">Idle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="160" x="739.804" y="181.4355">entry/this.packetSize = 0;</text><rect fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="78" x="723.804" y="281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="723.804" x2="801.804" y1="307.2969" y2="307.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="733.804" y="298.9951">WaitSize</text><rect fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="580.304" y="438"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="580.304" x2="731.304" y1="464.2969" y2="464.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="590.304" y="455.9951">WaitPacketNumber</text><rect fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="181.304" y="139"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="181.304" x2="306.304" y1="165.2969" y2="165.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="191.304" y="156.9951">WaitPacketSize</text><rect fill="#FEFECE" filter="url(#f6hx1o08ljaqj)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="188.304" y="281"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="188.304" x2="295.304" y1="307.2969" y2="307.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="198.304" y="298.9951">ReceiveData</text><!--link *start to driver.Idle--><path d="M861.364,29.883 C855.761,50.285 841.765,101.244 832.806,133.864 " fill="none" id="*start-driver.Idle" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="831.413,138.934,837.6539,131.3148,832.7373,134.1126,829.9396,129.196,831.413,138.934" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="852.804" y="90.0669">/this.packetNumber = 0;</text><!--link driver.Idle to driver.WaitSize--><path d="M814.145,189.067 C803.455,213.207 786.985,250.397 775.595,276.116 " fill="none" id="driver.Idle-driver.WaitSize" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="773.53,280.779,780.8332,274.1712,775.5557,276.2077,773.5191,270.9301,773.53,280.779" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="799.804" y="239.5669">after(10ms)/device.askData();</text><!--link driver.WaitSize to driver.WaitPacketNumber--><path d="M746.085,331.219 C726.925,358.973 695.568,404.3973 675.311,433.7424 " fill="none" id="driver.WaitSize-driver.WaitPacketNumber" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="672.405,437.9513,680.8093,432.8163,675.2451,433.8362,674.2252,428.2721,672.405,437.9513" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="798.804" y="374.0669">write(byte)/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="725.804" y="389.1997">this.memoryBlock = malloc(byte);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="787.804" y="404.3325">this.offset = 0;</text><!--link driver.WaitPacketNumber to driver.choice1--><path d="M648.387,437.7733 C623.595,356.786 544.086,97.057 524.967,34.601 " fill="none" id="driver.WaitPacketNumber-driver.choice1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="523.5,29.809,522.3089,39.5856,524.9632,34.5901,529.9586,37.2444,523.5,29.809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="642.304" y="232.0669">write(byte)/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="591.804" y="247.1997">this.packetNumber = byte;</text><!--link driver.choice1 to driver.Idle--><path d="M529.806,23.011 C549.141,27.62 595.576,40.255 628.804,62 C653.261,78.006 650.209,93.206 674.804,109 C692.376,120.284 712.62,129.608 732.434,137.146 " fill="none" id="driver.choice1-driver.Idle" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="737.19,138.924,730.1634,132.0228,732.5073,137.1712,727.3589,139.5151,737.19,138.924" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="732.804" y="75.0669">[else]/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="676.804" y="90.1997">process(memoryBlock);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="675.804" y="105.3325">free(this.memoryBlock);</text><!--link driver.choice1 to driver.WaitPacketSize--><path d="M509.361,20.832 C461.741,20.398 280.122,21.455 244.804,62 C227.992,81.3 230.026,111.425 234.881,133.757 " fill="none" id="driver.choice1-driver.WaitPacketSize" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="236.024,138.682,237.8869,129.0109,234.8942,133.8113,230.0938,130.8186,236.024,138.682" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="245.804" y="90.0669">[this.packetNumber &gt; 0]</text><!--link driver.WaitPacketSize to driver.ReceiveData--><path d="M241.087,189.16 C240.165,198.473 239.256,209.219 238.804,219 C237.929,237.934 238.658,259.225 239.616,275.885 " fill="none" id="driver.WaitPacketSize-driver.ReceiveData" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="239.919,280.899,243.3691,271.6742,239.6175,275.9081,235.3836,272.1566,239.919,280.899" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="277.804" y="232.0669">write(byte)/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="239.804" y="247.1997">this.packetSize = byte;</text><!--link driver.ReceiveData to driver.choice--><path d="M188.291,312.231 C128.378,319.323 36.8904,334.281 15.8037,361 C2.8626,377.397 2.6389,391.7816 15.8037,408 C46.5766,445.9108 205.771,458.1853 256.944,461.1832 " fill="none" id="driver.ReceiveData-driver.choice" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="262.096,461.4747,253.3367,456.972,257.104,461.1918,252.8841,464.9592,262.096,461.4747" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="86.8037" y="374.0669">write(byte)/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="16.8036" y="389.1997">this.memoryBlock[offset] = byte;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="20.8036" y="404.3325">this.offset++; this.packetSize--;</text><!--link driver.choice to driver.ReceiveData--><path d="M270.934,452.6531 C266.424,430.1005 254.791,371.935 247.665,336.305 " fill="none" id="driver.choice-driver.ReceiveData" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="246.647,331.219,244.4913,340.8291,247.6284,336.1217,252.3357,339.2588,246.647,331.219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="263.804" y="389.0669">[this.packetSize &gt; 0]</text><!--link driver.choice to driver.choice1--><path d="M283.198,461.1752 C308.762,458.5503 374.927,448.0241 406.804,408 C459.791,341.471 413.355,300.755 436.804,219 C457.825,145.71 498.752,63.37 514.457,33.042 " fill="none" id="driver.choice-driver.choice1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="516.921,28.313,509.2154,34.4468,514.611,32.7474,516.3104,38.1429,516.921,28.313" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="485.804" y="232.0669">[else]/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="437.804" y="247.1997">this.packetNumber--;</text><!--
@startuml
		

			
			
						state driver.choice1 <<choice>>
						
						state driver.choice <<choice>>
						
						driver.Idle : entry/this.packetSize = 0;
						
						
						
						state "Idle" as driver.Idle  {
							
			
			
		
						}
						
						
						
						
						
						state "WaitSize" as driver.WaitSize  {
							
			
			
		
						}
						
						
						
						
						
						state "WaitPacketNumber" as driver.WaitPacketNumber  {
							
			
			
		
						}
						
						
						
						
						
						state "WaitPacketSize" as driver.WaitPacketSize  {
							
			
			
		
						}
						
						
						
						
						
						state "ReceiveData" as driver.ReceiveData  {
							
			
			
		
						}
						
			
				[*] - -> driver.Idle : /this.packetNumber = 0;
				driver.Idle - -> driver.WaitSize : after(10ms)/device.askData();
				driver.WaitSize - -> driver.WaitPacketNumber : write(byte)/\nthis.memoryBlock = malloc(byte);\nthis.offset = 0;
				driver.WaitPacketNumber - -> driver.choice1 : write(byte)/\nthis.packetNumber = byte;
				driver.choice1 - -> driver.Idle : [else]/\nprocess(memoryBlock);\nfree(this.memoryBlock);
				driver.choice1 - -> driver.WaitPacketSize : [this.packetNumber > 0]
				driver.WaitPacketSize - -> driver.ReceiveData : write(byte)/\nthis.packetSize = byte;
				driver.ReceiveData - -> driver.choice : write(byte)/\nthis.memoryBlock[offset] = byte;\nthis.offset++; this.packetSize- -;
				driver.choice - -> driver.ReceiveData : [this.packetSize > 0]
				driver.choice - -> driver.choice1 : [else]/\nthis.packetNumber- -;
		
@enduml

PlantUML version 1.2019.03(Sun Mar 10 12:04:44 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_265-8u265-b01-0ubuntu2~16.04-b01
Operating System: Linux
OS Version: 4.4.0-186-generic
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>